{% extends "base.html" %}

{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - MomsVPN Admin{% endblock %}
{% block page_title %}üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏{% endblock %}

{% block actions %}
<form class="search-form" method="GET" action="/admin/users">
    <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ username..." value="{{ search or '' }}" class="search-input">
    <select name="status" class="filter-select">
        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="active" {% if status=='active' %}selected{% endif %}>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
        <option value="disabled" {% if status=='disabled' %}selected{% endif %}>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</option>
        <option value="limited" {% if status=='limited' %}selected{% endif %}>–õ–∏–º–∏—Ç</option>
        <option value="expired" {% if status=='expired' %}selected{% endif %}>–ò—Å—Ç—ë–∫</option>
    </select>
    <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
</form>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
        <span class="badge">{{ total }} –≤—Å–µ–≥–æ</span>
    </div>
    <div class="card-body">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–¢—Ä–∞—Ñ–∏–∫</th>
                    <th>–ò—Å—Ç–µ–∫–∞–µ—Ç</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>
                        <a href="/admin/users/{{ user.username.replace('user_', '') }}" class="user-link">
                            {{ user.username }}
                        </a>
                    </td>
                    <td>
                        <span class="status-badge status-{{ user.status }}">
                            {{ user.status }}
                        </span>
                    </td>
                    <td>
                        {% set used_gb = (user.used_traffic or 0) / (1024**3) %}
                        {% set limit_gb = (user.data_limit or 0) / (1024**3) %}
                        {% if user.data_limit %}
                        {{ "%.2f"|format(used_gb) }} / {{ "%.0f"|format(limit_gb) }} –ì–ë
                        {% else %}
                        {{ "%.2f"|format(used_gb) }} –ì–ë / ‚àû
                        {% endif %}
                    </td>
                    <td>
                        {% if user.expire %}
                        {{ user.expire | timestamp_to_date }}
                        {% else %}
                        ‚ôæÔ∏è –ë–µ—Å—Å—Ä–æ—á–Ω–æ
                        {% endif %}
                    </td>
                    <td>
                        <a href="/admin/users/{{ user.username.replace('user_', '') }}" class="btn btn-sm">–î–µ—Ç–∞–ª–∏</a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="empty-state">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}